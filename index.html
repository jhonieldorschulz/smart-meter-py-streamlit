<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia Completo: De Notebook Prototipado para Servi√ßo Online com DDD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-800">
    <!-- Navega√ß√£o -->
    <nav class="sticky top-0 bg-white shadow-md z-50">
        <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-blue-600">Smart Meter Guide</h1>
            <ul class="flex space-x-6 text-sm font-medium">
                <li><a href="#introducao" class="hover:text-blue-600">Introdu√ß√£o</a></li>
                <li><a href="#arquitetura" class="hover:text-blue-600">Arquitetura</a></li>
                <li><a href="#implementacao" class="hover:text-blue-600">Implementa√ß√£o</a></li>
                <li><a href="#conclusao" class="hover:text-blue-600">Conclus√£o</a></li>
            </ul>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="bg-gradient-to-r from-blue-600 to-blue-800 text-white py-16">
        <div class="max-w-6xl mx-auto px-6 text-center">
            <h2 class="text-4xl font-bold mb-4">Transformando um Notebook em um Servi√ßo Online</h2>
            <p class="text-xl opacity-90">Um guia pr√°tico de engenharia de software para projetos de Machine Learning em produ√ß√£o</p>
            <p class="text-sm mt-4 opacity-75">Com Arquitetura DDD, Princ√≠pios SOLID, Padr√µes de Projeto e Integra√ß√£o com PostgreSQL</p>
        </div>
    </section>

    <div class="max-w-6xl mx-auto px-6 py-12">
        <!-- Introdu√ß√£o -->
        <section id="introducao" class="mb-16">
            <h2 class="text-3xl font-bold mb-6 text-blue-600">1. Introdu√ß√£o</h2>
            
            <div class="bg-blue-50 border-l-4 border-blue-600 p-6 rounded mb-6">
                <h3 class="text-xl font-semibold mb-3">Contexto do Projeto</h3>
                <p class="mb-4">
                    Este guia documenta a transforma√ß√£o de um <strong>prot√≥tipo desenvolvido em Jupyter Notebook</strong> para um <strong>servi√ßo online robusto e escal√°vel</strong>. O projeto original envolvia a an√°lise de dados de medidores inteligentes de uma empresa de energia, com foco em:
                </p>
                <ul class="list-disc list-inside space-y-2 ml-4">
                    <li><strong>Previs√£o de Demanda:</strong> Utilizar hist√≥rico de consumo para prever a demanda futura de energia.</li>
                    <li><strong>Otimiza√ß√£o de Aloca√ß√£o de Transformadores:</strong> Identificar per√≠odos de pico para planejamento de infraestrutura.</li>
                    <li><strong>Gera√ß√£o Distribu√≠da:</strong> Sugerir quando ativar fontes alternativas de energia para balancear a carga.</li>
                </ul>
            </div>

            <h3 class="text-xl font-semibold mb-4">Desafios Enfrentados</h3>
            <p class="mb-4">
                O notebook prototipado, embora funcional para an√°lise, apresentava limita√ß√µes cr√≠ticas para um ambiente de produ√ß√£o:
            </p>
            <table class="w-full border-collapse mb-6">
                <thead>
                    <tr class="bg-gray-200">
                        <th class="border p-3 text-left">Aspecto</th>
                        <th class="border p-3 text-left">Notebook (Prot√≥tipo)</th>
                        <th class="border p-3 text-left">Servi√ßo Online</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="border p-3 font-semibold">Dados</td>
                        <td class="border p-3">CSV est√°tico, carregado manualmente</td>
                        <td class="border p-3">Banco de dados em tempo real com atualiza√ß√µes cont√≠nuas</td>
                    </tr>
                    <tr class="bg-gray-50">
                        <td class="border p-3 font-semibold">Escalabilidade</td>
                        <td class="border p-3">Limitada a um √∫nico usu√°rio/m√°quina</td>
                        <td class="border p-3">M√∫ltiplos usu√°rios simult√¢neos via API</td>
                    </tr>
                    <tr>
                        <td class="border p-3 font-semibold">Manutenibilidade</td>
                        <td class="border p-3">C√≥digo monol√≠tico e desorganizado</td>
                        <td class="border p-3">Arquitetura modular com separa√ß√£o de responsabilidades</td>
                    </tr>
                    <tr class="bg-gray-50">
                        <td class="border p-3 font-semibold">Testabilidade</td>
                        <td class="border p-3">Dif√≠cil de testar automaticamente</td>
                        <td class="border p-3">Inje√ß√£o de depend√™ncia permite testes unit√°rios</td>
                    </tr>
                    <tr>
                        <td class="border p-3 font-semibold">Interface</td>
                        <td class="border p-3">Gr√°ficos est√°ticos no notebook</td>
                        <td class="border p-3">Dashboard interativo com Streamlit</td>
                    </tr>
                </tbody>
            </table>

            <h3 class="text-xl font-semibold mb-4">Solu√ß√£o Proposta</h3>
            <p>
                A solu√ß√£o implementada utiliza <strong>Arquitetura Orientada a Dom√≠nio (DDD)</strong>, <strong>Programa√ß√£o Orientada a Objetos (POO)</strong>, <strong>Princ√≠pios SOLID</strong> e <strong>Padr√µes de Projeto</strong> para criar uma arquitetura robusta, test√°vel e escal√°vel. Os componentes principais incluem:
            </p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
                <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-blue-600">
                    <h4 class="font-bold mb-2">üìä Dataset CSV</h4>
                    <p class="text-sm">Dados sint√©ticos de medidores inteligentes em formato CSV para an√°lise inicial.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-green-600">
                    <h4 class="font-bold mb-2">üî¨ Notebook Prototipado</h4>
                    <p class="text-sm">An√°lise explorat√≥ria e previs√£o com ARIMA, servindo como prova de conceito.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-purple-600">
                    <h4 class="font-bold mb-2">üèóÔ∏è Arquitetura DDD</h4>
                    <p class="text-sm">Estrutura modular com separa√ß√£o clara entre dom√≠nio, aplica√ß√£o e infraestrutura.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-red-600">
                    <h4 class="font-bold mb-2">‚ö° FastAPI</h4>
                    <p class="text-sm">API REST moderna com inje√ß√£o de depend√™ncia e valida√ß√£o autom√°tica.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-yellow-600">
                    <h4 class="font-bold mb-2">üóÑÔ∏è PostgreSQL</h4>
                    <p class="text-sm">Banco de dados relacional com Docker para persist√™ncia e escalabilidade.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-indigo-600">
                    <h4 class="font-bold mb-2">üìà Streamlit</h4>
                    <p class="text-sm">Dashboard interativo para visualiza√ß√£o de previs√µes e insights em tempo real.</p>
                </div>
            </div>
        </section>

        <!-- Arquitetura -->
        <section id="arquitetura" class="mb-16">
            <h2 class="text-3xl font-bold mb-6 text-blue-600">2. Arquitetura DDD e Princ√≠pios SOLID</h2>

            <h3 class="text-xl font-semibold mb-4">2.1 Vis√£o Geral da Arquitetura</h3>
            <p class="mb-6">
                A arquitetura segue o padr√£o <strong>Domain-Driven Design (DDD)</strong>, que organiza o c√≥digo em camadas bem definidas, cada uma com responsabilidades espec√≠ficas:
            </p>

            <div class="bg-white p-8 rounded-lg shadow-md mb-6">
                <div class="space-y-4">
                    <div class="flex items-start">
                        <div class="bg-blue-600 text-white rounded-full w-10 h-10 flex items-center justify-center mr-4 flex-shrink-0">1</div>
                        <div>
                            <h4 class="font-bold">Domain Layer (Camada de Dom√≠nio)</h4>
                            <p class="text-sm text-gray-600">Cont√©m a l√≥gica de neg√≥cio pura, independente de frameworks ou detalhes t√©cnicos. Inclui entidades, value objects, servi√ßos de dom√≠nio e interfaces de reposit√≥rio.</p>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <div class="bg-green-600 text-white rounded-full w-10 h-10 flex items-center justify-center mr-4 flex-shrink-0">2</div>
                        <div>
                            <h4 class="font-bold">Application Layer (Camada de Aplica√ß√£o)</h4>
                            <p class="text-sm text-gray-600">Orquestra o fluxo de trabalho usando casos de uso (Use Cases). Coordena entre o dom√≠nio e a infraestrutura, sem conter l√≥gica de neg√≥cio complexa.</p>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <div class="bg-purple-600 text-white rounded-full w-10 h-10 flex items-center justify-center mr-4 flex-shrink-0">3</div>
                        <div>
                            <h4 class="font-bold">Infrastructure Layer (Camada de Infraestrutura)</h4>
                            <p class="text-sm text-gray-600">Implementa detalhes t√©cnicos como banco de dados, APIs externas, frameworks web. Cont√©m reposit√≥rios concretos, adaptadores e configura√ß√µes.</p>
                        </div>
                    </div>
                </div>
            </div>

            <h3 class="text-xl font-semibold mb-4">2.2 Princ√≠pios SOLID Aplicados</h3>

            <div class="space-y-6">
                <div class="bg-gradient-to-r from-red-50 to-red-100 p-6 rounded-lg border-l-4 border-red-600">
                    <h4 class="font-bold text-red-800 mb-2">S - Single Responsibility Principle</h4>
                    <p class="text-sm mb-3"><strong>Cada classe tem uma √∫nica raz√£o para mudar.</strong></p>
                    <p class="text-sm"><strong>Aplica√ß√£o:</strong> A classe <code class="bg-red-200 px-2 py-1 rounded">ForecastingService</code> √© respons√°vel apenas pela l√≥gica de previs√£o. A classe <code class="bg-red-200 px-2 py-1 rounded">ForecastingUseCase</code> orquestra o fluxo, e o <code class="bg-red-200 px-2 py-1 rounded">Repository</code> gerencia o acesso aos dados.</p>
                </div>

                <div class="bg-gradient-to-r from-orange-50 to-orange-100 p-6 rounded-lg border-l-4 border-orange-600">
                    <h4 class="font-bold text-orange-800 mb-2">O - Open/Closed Principle</h4>
                    <p class="text-sm mb-3"><strong>Aberto para extens√£o, fechado para modifica√ß√£o.</strong></p>
                    <p class="text-sm"><strong>Aplica√ß√£o:</strong> A interface <code class="bg-orange-200 px-2 py-1 rounded">ISmartMeterRepository</code> permite trocar entre <code class="bg-orange-200 px-2 py-1 rounded">InMemorySmartMeterRepository</code> e <code class="bg-orange-200 px-2 py-1 rounded">PostgresSmartMeterRepository</code> sem alterar o c√≥digo da aplica√ß√£o.</p>
                </div>

                <div class="bg-gradient-to-r from-yellow-50 to-yellow-100 p-6 rounded-lg border-l-4 border-yellow-600">
                    <h4 class="font-bold text-yellow-800 mb-2">L - Liskov Substitution Principle</h4>
                    <p class="text-sm mb-3"><strong>Subclasses devem ser substitu√≠veis por suas classes base.</strong></p>
                    <p class="text-sm"><strong>Aplica√ß√£o:</strong> Ambas as implementa√ß√µes de reposit√≥rio (<code class="bg-yellow-200 px-2 py-1 rounded">InMemory</code> e <code class="bg-yellow-200 px-2 py-1 rounded">Postgres</code>) implementam a mesma interface e podem ser usadas intercambiavelmente.</p>
                </div>

                <div class="bg-gradient-to-r from-green-50 to-green-100 p-6 rounded-lg border-l-4 border-green-600">
                    <h4 class="font-bold text-green-800 mb-2">I - Interface Segregation Principle</h4>
                    <p class="text-sm mb-3"><strong>Clientes n√£o devem depender de interfaces que n√£o usam.</strong></p>
                    <p class="text-sm"><strong>Aplica√ß√£o:</strong> A interface <code class="bg-green-200 px-2 py-1 rounded">ISmartMeterRepository</code> define apenas os m√©todos necess√°rios para a previs√£o, evitando m√©todos desnecess√°rios.</p>
                </div>

                <div class="bg-gradient-to-r from-blue-50 to-blue-100 p-6 rounded-lg border-l-4 border-blue-600">
                    <h4 class="font-bold text-blue-800 mb-2">D - Dependency Inversion Principle</h4>
                    <p class="text-sm mb-3"><strong>Dependa de abstra√ß√µes, n√£o de implementa√ß√µes concretas.</strong></p>
                    <p class="text-sm"><strong>Aplica√ß√£o:</strong> O <code class="bg-blue-200 px-2 py-1 rounded">ForecastingUseCase</code> depende da interface <code class="bg-blue-200 px-2 py-1 rounded">ISmartMeterRepository</code>, n√£o de uma implementa√ß√£o espec√≠fica. A inje√ß√£o de depend√™ncia (via FastAPI) fornece a implementa√ß√£o concreta em tempo de execu√ß√£o.</p>
                </div>
            </div>

            <h3 class="text-xl font-semibold mb-4 mt-8">2.3 Padr√µes de Projeto Utilizados</h3>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h4 class="font-bold mb-2">üè≠ Factory Pattern</h4>
                    <p class="text-sm">Usado nas depend√™ncias do FastAPI (<code class="bg-gray-200 px-2 py-1 rounded">get_smart_meter_repository</code>, <code class="bg-gray-200 px-2 py-1 rounded">get_forecasting_use_case</code>) para criar inst√¢ncias com inje√ß√£o de depend√™ncia.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h4 class="font-bold mb-2">üì¶ Repository Pattern</h4>
                    <p class="text-sm">Abstrai o acesso aos dados, permitindo trocar a fonte de dados sem alterar a l√≥gica de neg√≥cio.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h4 class="font-bold mb-2">üéØ Use Case Pattern</h4>
                    <p class="text-sm">Encapsula a l√≥gica de aplica√ß√£o em casos de uso espec√≠ficos, facilitando a testabilidade e a reutiliza√ß√£o.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h4 class="font-bold mb-2">üíâ Dependency Injection</h4>
                    <p class="text-sm">Implementado via FastAPI para fornecer depend√™ncias em tempo de execu√ß√£o, facilitando testes e configura√ß√£o.</p>
                </div>
            </div>
        </section>

        <!-- Implementa√ß√£o -->
        <section id="implementacao" class="mb-16">
            <h2 class="text-3xl font-bold mb-6 text-blue-600">3. Implementa√ß√£o Pr√°tica</h2>

            <h3 class="text-xl font-semibold mb-4">3.1 Estrutura de Diret√≥rios</h3>
            <p class="mb-4">
                A estrutura do projeto segue a organiza√ß√£o DDD, com separa√ß√£o clara entre camadas:
            </p>
            <pre class="bg-gray-900 text-gray-100 p-6 rounded-lg overflow-x-auto mb-6"><code>smart_meter_guide/
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ smart_meter_data.csv          # Dataset sint√©tico
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ smart_meter/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entities.py           # SmartMeter (Agregado Raiz), ConsumptionRecord (Value Object)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ repository.py         # ISmartMeterRepository (Interface)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ forecasting/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ service.py            # ForecastingService (Servi√ßo de Dom√≠nio)
‚îÇ   ‚îú‚îÄ‚îÄ application/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ services/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ forecasting_use_case.py  # ForecastingUseCase (Orquestra√ß√£o)
‚îÇ   ‚îú‚îÄ‚îÄ infrastructure/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ in_memory_repository.py  # Implementa√ß√£o em mem√≥ria
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ postgres_repository.py   # Implementa√ß√£o PostgreSQL
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ schemas.py            # Schemas Pydantic
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ api.py                # Endpoints FastAPI
‚îÇ   ‚îî‚îÄ‚îÄ main.py                       # Entrada da aplica√ß√£o
‚îú‚îÄ‚îÄ dashboard.py                      # Dashboard Streamlit
‚îú‚îÄ‚îÄ docker-compose.yml                # Configura√ß√£o PostgreSQL
‚îî‚îÄ‚îÄ analysis_prototype.ipynb          # Notebook prototipado

            </code></pre>

            <h3 class="text-xl font-semibold mb-4">3.2 Exemplo de C√≥digo: Entidades de Dom√≠nio</h3>
            <p class="mb-4">
                As entidades de dom√≠nio representam os conceitos principais do neg√≥cio. Aqui, <code class="bg-gray-200 px-2 py-1 rounded">SmartMeter</code> √© um Agregado Raiz que encapsula a l√≥gica de um medidor inteligente:
            </p>
            <pre class="bg-gray-900 text-gray-100 p-6 rounded-lg overflow-x-auto mb-6"><code class="language-python">from datetime import datetime
from typing import List, Optional

# Value Object
class ConsumptionRecord:
    def __init__(self, timestamp: datetime, consumption_kwh: float, temperature_c: float, is_weekend: bool):
        if consumption_kwh < 0:
            raise ValueError("Consumption cannot be negative.")
        self.timestamp = timestamp
        self.consumption_kwh = consumption_kwh
        self.temperature_c = temperature_c
        self.is_weekend = is_weekend

# Aggregate Root
class SmartMeter:
    def __init__(self, meter_id: str, location: Optional[str] = None):
        if not meter_id:
            raise ValueError("Meter ID is required.")
        self.meter_id = meter_id
        self.location = location
        self._records: List[ConsumptionRecord] = []

    def add_record(self, record: ConsumptionRecord):
        self._records.append(record)

    def get_records(self) -> List[ConsumptionRecord]:
        return list(self._records)  # Retorna uma c√≥pia para garantir imutabilidade</code></pre>

            <h3 class="text-xl font-semibold mb-4">3.3 Exemplo de C√≥digo: Servi√ßo de Dom√≠nio</h3>
            <p class="mb-4">
                O servi√ßo de dom√≠nio encapsula a l√≥gica de previs√£o, independente de detalhes t√©cnicos:
            </p>
            <pre class="bg-gray-900 text-gray-100 p-6 rounded-lg overflow-x-auto mb-6"><code class="language-python">from statsmodels.tsa.arima.model import ARIMA
from datetime import datetime, timedelta
import pandas as pd

class ForecastingService:
    def __init__(self, model_order: Tuple[int, int, int] = (5, 1, 0)):
        self.model_order = model_order
        self._model = None
        self._last_train_data = None

    def train_model(self, historical_data: pd.Series):
        if historical_data.empty:
            raise ValueError("Historical data cannot be empty for training.")
        
        model = ARIMA(historical_data, order=self.model_order)
        self._model = model.fit()
        self._last_train_data = historical_data

    def predict_demand(self, steps: int) -> pd.Series:
        if self._model is None:
            raise RuntimeError("Model must be trained before making predictions.")
        
        forecast = self._model.forecast(steps=steps)
        last_time = self._last_train_data.index[-1]
        future_index = pd.date_range(start=last_time + timedelta(hours=1), periods=steps, freq='H')
        
        return pd.Series(forecast.values, index=future_index)</code></pre>

            <h3 class="text-xl font-semibold mb-4">3.4 Exemplo de C√≥digo: Caso de Uso (Application Service)</h3>
            <p class="mb-4">
                O caso de uso orquestra o fluxo de trabalho, injetando as depend√™ncias:
            </p>
            <pre class="bg-gray-900 text-gray-100 p-6 rounded-lg overflow-x-auto mb-6"><code class="language-python">class ForecastingUseCase:
    def __init__(self, repository: ISmartMeterRepository, service: ForecastingService):
        self.repository = repository
        self.service = service

    def execute(self, start_date: datetime, end_date: datetime, steps: int) -> pd.Series:
        try:
            # 1. Obter dados hist√≥ricos agregados
            historical_data_dict = self.repository.get_total_consumption_by_hour(start_date, end_date)
            
            # 2. Converter para pd.Series
            historical_data = pd.Series(
                data=[item['consumption'] for item in historical_data_dict],
                index=[item['timestamp'] for item in historical_data_dict]
            )
            
            # 3. Treinar o modelo
            self.service.train_model(historical_data)
            
            # 4. Realizar a previs√£o
            forecast_series = self.service.predict_demand(steps)
            
            return forecast_series
        except Exception as e:
            raise RuntimeError(f"Falha ao executar a previs√£o de demanda: {e}")</code></pre>

            <h3 class="text-xl font-semibold mb-4">3.5 Exemplo de C√≥digo: API FastAPI com Inje√ß√£o de Depend√™ncia</h3>
            <p class="mb-4">
                A API FastAPI utiliza inje√ß√£o de depend√™ncia para fornecer inst√¢ncias dos servi√ßos:
            </p>
            <pre class="bg-gray-900 text-gray-100 p-6 rounded-lg overflow-x-auto mb-6"><code class="language-python">from fastapi import FastAPI, Depends, HTTPException

app = FastAPI(title="Smart Meter Forecasting API")

# Depend√™ncias (Factory Pattern)
def get_smart_meter_repository() -> ISmartMeterRepository:
    return InMemorySmartMeterRepository(initial_data_path=REPO_PATH)

def get_forecasting_use_case(
    repository: ISmartMeterRepository = Depends(get_smart_meter_repository)
) -> ForecastingUseCase:
    forecasting_service = ForecastingService(model_order=(5, 1, 0))
    return ForecastingUseCase(repository=repository, service=forecasting_service)

# Endpoint
@app.post("/forecast/demand", response_model=List[ForecastResponseSchema])
async def forecast_demand(
    request: ForecastRequestSchema,
    use_case: ForecastingUseCase = Depends(get_forecasting_use_case)
):
    try:
        forecast_series = use_case.execute(
            start_date=request.start_date,
            end_date=request.end_date,
            steps=request.steps
        )
        
        response_data = []
        for timestamp, prediction in forecast_series.items():
            response_data.append(ForecastResponseSchema(
                timestamp=timestamp,
                predicted_consumption_kwh=prediction
            ))
        
        return response_data
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))</code></pre>

            <h3 class="text-xl font-semibold mb-4">3.6 Configura√ß√£o do Banco de Dados com Docker</h3>
            <p class="mb-4">
                O arquivo <code class="bg-gray-200 px-2 py-1 rounded">docker-compose.yml</code> define o servi√ßo PostgreSQL:
            </p>
            <pre class="bg-gray-900 text-gray-100 p-6 rounded-lg overflow-x-auto mb-6"><code class="language-yaml">version: '3.8'

services:
  db:
    image: postgres:14-alpine
    restart: always
    environment:
      POSTGRES_DB: smart_meter_db
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data/

volumes:
  postgres_data:</code></pre>

            <p class="mb-4">
                Para iniciar o banco de dados, execute:
            </p>
            <pre class="bg-gray-900 text-gray-100 p-6 rounded-lg overflow-x-auto mb-6"><code class="language-bash">docker-compose up -d</code></pre>

            <h3 class="text-xl font-semibold mb-4">3.7 Dashboard Streamlit</h3>
            <p class="mb-4">
                O dashboard interativo consome a API FastAPI para exibir previs√µes em tempo real:
            </p>
            <pre class="bg-gray-900 text-gray-100 p-6 rounded-lg overflow-x-auto mb-6"><code class="language-python">import streamlit as st
import requests
import pandas as pd

st.set_page_config(page_title="Dashboard de Previs√£o de Demanda", layout="wide")

API_URL = "http://localhost:8000/forecast/demand"

@st.cache_data(ttl=60)
def get_api_health():
    try:
        response = requests.get("http://localhost:8000/health")
        return response.status_code == 200
    except:
        return False

def get_forecast(start_date, end_date, steps):
    payload = {
        "start_date": start_date.isoformat(),
        "end_date": end_date.isoformat(),
        "steps": steps
    }
    response = requests.post(API_URL, json=payload)
    return pd.DataFrame(response.json())

st.title("‚ö°Ô∏è Dashboard de Previs√£o de Demanda de Energia")

# Controles
end_date = st.sidebar.date_input("Data Final dos Dados Hist√≥ricos")
steps = st.sidebar.slider("Horas de Previs√£o", 1, 72, 24)

if st.sidebar.button("Gerar Previs√£o"):
    forecast_df = get_forecast(start_date, end_date, steps)
    st.line_chart(forecast_df)</code></pre>

            <h3 class="text-xl font-semibold mb-4">3.8 Executando o Projeto</h3>
            <p class="mb-4">
                Para executar o projeto completo, siga os passos abaixo:
            </p>
            <ol class="list-decimal list-inside space-y-3 mb-6">
                <li><strong>Instalar depend√™ncias:</strong>
                    <pre class="bg-gray-900 text-gray-100 p-3 rounded mt-2"><code>pip install fastapi uvicorn pydantic pandas numpy matplotlib scikit-learn statsmodels streamlit requests sqlalchemy psycopg2-binary</code></pre>
                </li>
                <li><strong>Gerar dados:</strong>
                    <pre class="bg-gray-900 text-gray-100 p-3 rounded mt-2"><code>python3 generate_data.py</code></pre>
                </li>
                <li><strong>Iniciar o banco de dados (opcional):</strong>
                    <pre class="bg-gray-900 text-gray-100 p-3 rounded mt-2"><code>docker-compose up -d</code></pre>
                </li>
                <li><strong>Executar a API:</strong>
                    <pre class="bg-gray-900 text-gray-100 p-3 rounded mt-2"><code>python3 -m src.main</code></pre>
                </li>
                <li><strong>Executar o dashboard (em outro terminal):</strong>
                    <pre class="bg-gray-900 text-gray-100 p-3 rounded mt-2"><code>streamlit run dashboard.py</code></pre>
                </li>
            </ol>
        </section>

        <!-- Conclus√£o -->
        <section id="conclusao" class="mb-16">
            <h2 class="text-3xl font-bold mb-6 text-blue-600">4. Conclus√£o e Pr√≥ximos Passos</h2>

            <h3 class="text-xl font-semibold mb-4">Benef√≠cios da Abordagem DDD + SOLID</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div class="bg-green-50 p-6 rounded-lg border-l-4 border-green-600">
                    <h4 class="font-bold text-green-800 mb-2">‚úÖ Manutenibilidade</h4>
                    <p class="text-sm">O c√≥digo √© organizado em camadas bem definidas, facilitando a localiza√ß√£o e corre√ß√£o de bugs.</p>
                </div>
                <div class="bg-green-50 p-6 rounded-lg border-l-4 border-green-600">
                    <h4 class="font-bold text-green-800 mb-2">‚úÖ Testabilidade</h4>
                    <p class="text-sm">A inje√ß√£o de depend√™ncia permite criar testes unit√°rios sem depend√™ncias externas.</p>
                </div>
                <div class="bg-green-50 p-6 rounded-lg border-l-4 border-green-600">
                    <h4 class="font-bold text-green-800 mb-2">‚úÖ Escalabilidade</h4>
                    <p class="text-sm">A arquitetura modular permite adicionar novas funcionalidades sem afetar o c√≥digo existente.</p>
                </div>
                <div class="bg-green-50 p-6 rounded-lg border-l-4 border-green-600">
                    <h4 class="font-bold text-green-800 mb-2">‚úÖ Flexibilidade</h4>
                    <p class="text-sm">Trocar de banco de dados (PostgreSQL, MongoDB, etc.) √© simples, pois a l√≥gica de neg√≥cio n√£o depende da implementa√ß√£o.</p>
                </div>
            </div>

            <h3 class="text-xl font-semibold mb-4">Pr√≥ximos Passos para Produ√ß√£o</h3>
            <div class="space-y-4 mb-6">
                <div class="bg-blue-50 p-6 rounded-lg border-l-4 border-blue-600">
                    <h4 class="font-bold text-blue-800 mb-2">1. Testes Automatizados</h4>
                    <p class="text-sm">Implementar testes unit√°rios (pytest) para as entidades de dom√≠nio e casos de uso, e testes de integra√ß√£o para a API.</p>
                </div>
                <div class="bg-blue-50 p-6 rounded-lg border-l-4 border-blue-600">
                    <h4 class="font-bold text-blue-800 mb-2">2. CI/CD Pipeline</h4>
                    <p class="text-sm">Configurar GitHub Actions ou GitLab CI para executar testes automaticamente e fazer deploy cont√≠nuo.</p>
                </div>
                <div class="bg-blue-50 p-6 rounded-lg border-l-4 border-blue-600">
                    <h4 class="font-bold text-blue-800 mb-2">3. Logging e Monitoramento</h4>
                    <p class="text-sm">Adicionar logging estruturado (ex: ELK Stack) e monitoramento de performance (ex: Prometheus, Grafana).</p>
                </div>
                <div class="bg-blue-50 p-6 rounded-lg border-l-4 border-blue-600">
                    <h4 class="font-bold text-blue-800 mb-2">4. Autentica√ß√£o e Autoriza√ß√£o</h4>
                    <p class="text-sm">Implementar JWT ou OAuth2 para proteger os endpoints da API.</p>
                </div>
                <div class="bg-blue-50 p-6 rounded-lg border-l-4 border-blue-600">
                    <h4 class="font-bold text-blue-800 mb-2">5. Containeriza√ß√£o Completa</h4>
                    <p class="text-sm">Criar Dockerfiles para a API e o dashboard, e orquestrar com Kubernetes para escalabilidade horizontal.</p>
                </div>
                <div class="bg-blue-50 p-6 rounded-lg border-l-4 border-blue-600">
                    <h4 class="font-bold text-blue-800 mb-2">6. Modelos de ML Avan√ßados</h4>
                    <p class="text-sm">Experimentar com SARIMAX, Prophet, ou redes neurais (LSTM) para melhorar a precis√£o das previs√µes.</p>
                </div>
            </div>

            <h3 class="text-xl font-semibold mb-4">Conclus√£o Final</h3>
            <p class="mb-4">
                Este guia demonstrou como transformar um prot√≥tipo em Jupyter Notebook em um servi√ßo online robusto e escal√°vel, aplicando princ√≠pios de engenharia de software bem estabelecidos. A combina√ß√£o de <strong>Arquitetura DDD</strong>, <strong>Princ√≠pios SOLID</strong> e <strong>Padr√µes de Projeto</strong> garante que o c√≥digo seja:
            </p>
            <ul class="list-disc list-inside space-y-2 mb-6 ml-4">
                <li><strong>F√°cil de entender:</strong> A organiza√ß√£o clara facilita a onboarding de novos desenvolvedores.</li>
                <li><strong>F√°cil de manter:</strong> Mudan√ßas em uma camada n√£o afetam as outras.</li>
                <li><strong>F√°cil de testar:</strong> A inje√ß√£o de depend√™ncia permite testes isolados.</li>
                <li><strong>F√°cil de estender:</strong> Novas funcionalidades podem ser adicionadas sem refatora√ß√£o massiva.</li>
            </ul>

            <div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-8 rounded-lg">
                <h4 class="text-xl font-bold mb-2">üéØ Resumo do Projeto</h4>
                <p class="mb-4">
                    Este guia forneceu uma abordagem completa para transformar um notebook prototipado em um servi√ßo online profissional. Os componentes entregues incluem:
                </p>
                <ul class="list-disc list-inside space-y-2">
                    <li>‚úÖ Dataset sint√©tico de medidores inteligentes (CSV)</li>
                    <li>‚úÖ Notebook prototipado com an√°lise explorat√≥ria e previs√£o ARIMA</li>
                    <li>‚úÖ Arquitetura DDD com separa√ß√£o clara de camadas</li>
                    <li>‚úÖ API FastAPI com inje√ß√£o de depend√™ncia e valida√ß√£o autom√°tica</li>
                    <li>‚úÖ Reposit√≥rio PostgreSQL com abstra√ß√£o de dados</li>
                    <li>‚úÖ Dashboard Streamlit interativo para visualiza√ß√£o</li>
                    <li>‚úÖ Documenta√ß√£o completa em HTML com TailwindCSS</li>
                </ul>
            </div>
        </section>

        <!-- Refer√™ncias -->
        <section class="mt-16 pt-8 border-t-2 border-gray-300">
            <h2 class="text-3xl font-bold mb-6 text-blue-600">Refer√™ncias e Recursos</h2>
            <ul class="space-y-3 text-sm">
                <li><strong>[1]</strong> <a href="https://martinfowler.com/bliki/DomainDrivenDesign.html" class="text-blue-600 hover:underline">Martin Fowler - Domain-Driven Design</a></li>
                <li><strong>[2]</strong> <a href="https://en.wikipedia.org/wiki/SOLID" class="text-blue-600 hover:underline">Wikipedia - SOLID (object-oriented design)</a></li>
                <li><strong>[3]</strong> <a href="https://fastapi.tiangolo.com/" class="text-blue-600 hover:underline">FastAPI Official Documentation</a></li>
                <li><strong>[4]</strong> <a href="https://www.postgresql.org/" class="text-blue-600 hover:underline">PostgreSQL Official Website</a></li>
                <li><strong>[5]</strong> <a href="https://streamlit.io/" class="text-blue-600 hover:underline">Streamlit Official Website</a></li>
                <li><strong>[6]</strong> <a href="https://www.statsmodels.org/" class="text-blue-600 hover:underline">Statsmodels - Statistical Modeling and Econometrics</a></li>
                <li><strong>[7]</strong> <a href="https://www.docker.com/" class="text-blue-600 hover:underline">Docker Official Website</a></li>
                <li><strong>[8]</strong> <a href="https://refactoring.guru/design-patterns" class="text-blue-600 hover:underline">Refactoring Guru - Design Patterns</a></li>
            </ul>
        </section>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-300 py-8 mt-16">
        <div class="max-w-6xl mx-auto px-6 text-center">
            <p class="mb-2">Guia Completo: De Notebook Prototipado para Servi√ßo Online com DDD</p>
            <p class="text-sm opacity-75">Desenvolvido com ‚ù§Ô∏è por Manus AI | Outubro 2025</p>
        </div>
    </footer>

    <script>
        // Highlight.js para colorir c√≥digo
        hljs.highlightAll();
    </script>
</body>
</html>

